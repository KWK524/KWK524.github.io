<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FGIP OJT Unified Dashboard</title>
    <style>
        :root {
            --bg-color: #f0f2f5; --card-bg: #ffffff; --text-main: #1c1e21;
            --text-sub: #606770; --accent-color: #007bff; --gauge-bg: #e9ecef;
            --highlight: #d9534f; --work-green: #28a745; --meal-orange: #fd7e14;
        }
        [data-theme="pink"] { --bg-color: #fff0f6; --card-bg: #ffffff; --text-main: #4b162c; --text-sub: #a67c8e; --accent-color: #ff85c0; --gauge-bg: #ffe0eb; }
        [data-theme="skyblue"] { --bg-color: #e6f7ff; --card-bg: #ffffff; --text-main: #002766; --text-sub: #69b1ff; --accent-color: #1890ff; --gauge-bg: #bae7ff; }
        [data-theme="dark"] { --bg-color: #121212; --card-bg: #1e1e1e; --text-main: #e0e0e0; --text-sub: #a0a0a0; --accent-color: #bb86fc; --gauge-bg: #333333; --highlight: #cf6679; }

        body { font-family: 'Pretendard', -apple-system, sans-serif; background: var(--bg-color); color: var(--text-main); margin: 0; padding: 20px; transition: 0.3s; }
        
        /* 3ë‹¨ ê·¸ë¦¬ë“œ ì„¤ì • (PC) */
        .dashboard-grid { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 20px; 
            max-width: 1400px; 
            margin: 0 auto; 
        }

        /* ëª¨ë°”ì¼ ëŒ€ì‘ (í™”ë©´ ì‘ì•„ì§€ë©´ 1ì—´ë¡œ) */
        @media (max-width: 1100px) { .dashboard-grid { grid-template-columns: 1fr; max-width: 500px; } }

        .card { background: var(--card-bg); border-radius: 20px; padding: 24px; box-shadow: 0 8px 24px rgba(0,0,0,0.05); display: flex; flex-direction: column; }
        .theme-selector { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; grid-column: 1 / -1; }
        .theme-btn { width: 20px; height: 20px; border-radius: 50%; cursor: pointer; border: 2px solid rgba(0,0,0,0.1); }

        /* ê³µí†µ ìŠ¤íƒ€ì¼ */
        h2 { font-size: 1.1rem; margin-top: 0; margin-bottom: 1.2rem; display: flex; align-items: center; gap: 8px; }
        .gauge-container { background: var(--gauge-bg); border-radius: 50px; height: 14px; overflow: hidden; margin-bottom: 8px; }
        .gauge-fill { height: 100%; background: var(--accent-color); transition: width 0.1s linear; }

        /* ì¹´ë“œ 1: í˜„í™© & ì‹ë‹¨ */
        .today-date { font-size: 1.8rem; font-weight: 800; margin-bottom: 5px; }
        .current-time { font-size: 1.1rem; color: var(--text-sub); margin-bottom: 15px; font-family: monospace; }
        .meal-box { margin-top: 15px; padding: 15px; border-radius: 12px; background: rgba(253, 126, 20, 0.08); border: 1px solid rgba(253, 126, 20, 0.1); }
        .meal-type { font-size: 0.7rem; background: var(--meal-orange); color: white; padding: 2px 6px; border-radius: 4px; margin-bottom: 5px; display: inline-block; }

        /* ì¹´ë“œ 2: ì¼ì •í‘œ(ìº˜ë¦°ë”) */
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }
        .cal-day { font-size: 0.75rem; text-align: center; padding: 5px; border-radius: 6px; cursor: pointer; position: relative; background: rgba(0,0,0,0.02); }
        .cal-day.has-event::after { content: ''; position: absolute; bottom: 3px; left: 50%; width: 4px; height: 4px; background: var(--highlight); border-radius: 50%; transform: translateX(-50%); }
        .cal-day:hover { background: var(--gauge-bg); }
        .event-list { margin-top: 15px; font-size: 0.85rem; max-height: 150px; overflow-y: auto; }
        .event-item { padding: 5px 0; border-bottom: 1px solid var(--gauge-bg); }

        /* ì¹´ë“œ 3: ê²Œì‹œíŒ */
        .comment-input-wrapper { background: rgba(0,0,0,0.03); border-radius: 12px; padding: 10px; margin-bottom: 1rem; }
        textarea { width: 100%; background: transparent; border: none; color: var(--text-main); font-family: inherit; resize: none; outline: none; min-height: 50px; }
        .comment-item { padding: 12px 0; border-bottom: 1px solid var(--gauge-bg); position: relative; }
        .like-btn { position: absolute; right: 0; bottom: 10px; cursor: pointer; color: var(--text-sub); font-size: 0.85rem; display: flex; align-items: center; gap: 4px; border: 1px solid var(--gauge-bg); padding: 2px 8px; border-radius: 20px; transition: 0.2s; }
        .like-btn:hover { background: #fff0f6; color: #ff85c0; border-color: #ff85c0; }
        .save-btn { background: var(--accent-color); color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; float: right; font-size: 0.85rem; }
    </style>
</head>
<body>

<div class="theme-selector">
    <div class="theme-btn" style="background:#ff85c0" onclick="setTheme('pink')"></div>
    <div class="theme-btn" style="background:#1890ff" onclick="setTheme('skyblue')"></div>
    <div class="theme-btn" style="background:#ffffff" onclick="setTheme('white')"></div>
    <div class="theme-btn" style="background:#333333" onclick="setTheme('dark')"></div>
</div>

<div class="dashboard-grid">
    <div class="card">
        <h2>ğŸ“Š OJT Status</h2>
        <div id="today-date" class="today-date"></div>
        <div id="current-time" class="current-time"></div>
        <div class="gauge-container"><div id="total-fill" class="gauge-fill"></div></div>
        <div id="total-percent" style="font-weight: bold; color: var(--accent-color); margin-bottom: 15px;">0.00%</div>
        
        <div id="daily-section" style="display:none; margin-bottom: 15px;">
            <div class="gauge-container" style="height: 8px;"><div id="daily-fill" class="gauge-fill" style="background:var(--work-green)"></div></div>
            <div id="daily-remain-text" style="font-size: 0.8rem; color: var(--work-green); font-weight: bold;"></div>
        </div>

        <div class="meal-box">
            <span id="next-meal-type" class="meal-type">ì¡°ì‹</span>
            <div id="next-meal-content" style="font-size: 0.9rem; font-weight: 500;">ë©”ë‰´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>
    </div>

    <div class="card">
        <div class="calendar-header">
            <h2 style="margin:0;">ğŸ“… ê³µìœ  ì¼ì •í‘œ</h2>
            <button class="save-btn" style="float:none;" onclick="addEvent()">ì¶”ê°€</button>
        </div>
        <div id="cal-month" style="font-size: 0.9rem; font-weight: bold; margin-bottom: 10px;">2026ë…„ 1ì›”</div>
        <div class="cal-grid" id="calendar-body">
            </div>
        <div class="event-list" id="event-list">
            <div style="color:var(--text-sub); text-align:center; padding-top:20px;">ë‚ ì§œë¥¼ ì„ íƒí•´ ì¼ì •ì„ í™•ì¸í•˜ì„¸ìš”.</div>
        </div>
    </div>

    <div class="card">
        <h2>ğŸ’¬ ì‹¤ì‹œê°„ ê²Œì‹œíŒ</h2>
        <div class="comment-input-wrapper">
            <textarea id="memo-input" placeholder="í•¨ê»˜ ë‚˜ëˆŒ ì´ì•¼ê¸°ë¥¼ ì ì–´ì£¼ì„¸ìš”..."></textarea>
            <button class="save-btn" onclick="saveMemo()">ë“±ë¡</button>
            <div style="clear:both;"></div>
        </div>
        <div id="memo-list" style="overflow-y: auto; flex-grow: 1; max-height: 400px;"></div>
    </div>
</div>

<script>
    // âš ï¸ êµ¬ê¸€ ìŠ¤í¬ë¦½íŠ¸ URLì„ ì…ë ¥í•˜ì„¸ìš”.
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwkynypFv3mDGgn9w0oWCzRzfbp0TxEib3pR6bxhDiB8-DqhM_gUpZ9JK0T7BfXBFKRkQ/exec"; 
    const START_DATE = new Date('2025-08-31T00:00:00+03:00');
    const END_DATE = new Date('2026-02-14T15:00:00+03:00');

    // ì‹ë‹¨ ë°ì´í„° (ì „ë‹¬í•´ì£¼ì‹  ì´ë¯¸ì§€ ê¸°ë°˜)
    const MEAL_DATA = {
        "2026-01-24": { "B": "ì¹˜ì¦ˆì—ê·¸ìƒŒë“œìœ„ì¹˜, ëˆ„ë£½ì§€, ì½©ë‚˜ë¬¼êµ­, ë² ì´ì»¨ê¹€ë°¥, ìŠ¤í¬ë¨ë¸”", "L": "ê°ˆì¹˜ì¡°ë¦¼, ê°ˆë¹„ì°œ, ëœì¥ì°Œê°œ, ê³„ë€ë§ì´, ê°ììƒëŸ¬ë“œ", "D": "ì§¬ë½•, í›„ë¼ì´ì¹˜í‚¨, ë–¡ê°ˆë¹„, ì°ë§Œë‘, ì–´ë¬µì „" },
        "2026-01-25": { "B": "BLTìƒŒë“œìœ„ì¹˜, í–„ì „, ë¶ˆê³ ê¸°, ì–‘ë°°ì¶”ë¬´ì¹¨, ê³„ë€í›„ë¼ì´", "L": "ë‹­ë³¶ìŒ, ì˜¤ì§•ì–´íŠ€ê¹€, ì†Œê³ ê¸°ë¯¸ì—­êµ­, ë‘ë¶€ì¡°ë¦¼, ë¯¸ì—­ì¤„ê¸°", "D": "ë¶ˆê³ ê¸°(í…Œì´ë¸”), ì¹˜í‚¨ì¹´ì¸ , ë¶ì–´ë³¶ìŒ, ê¹€ì¹˜ì „, ìƒì„ ì „" },
        "2026-01-26": { "B": "ì»µë¼ë©´, ì°¸ì¹˜ìƒŒë“œìœ„ì¹˜, ëˆ„ë£½ì§€, ì†Œê³ ê¸°ê¹€ë°¥, ê³„ë€í›„ë¼ì´", "L": "ì–‘ë…ì¹˜í‚¨, ìƒì„ ì „, ì–´ë¬µêµ­, ì¡ì±„, ë„ë¼ì§€ë‚˜ë¬¼", "D": "ì„¤ë íƒ•, ìœ¡ì „, ìƒˆìš°íŠ€ê¹€, ê¹€ì¹˜ë³¶ìŒ, ì–‘ë…ê°„ì¥" }
    };

    function setTheme(t) { document.body.setAttribute('data-theme', t); localStorage.setItem('theme', t); }
    if(localStorage.getItem('theme')) setTheme(localStorage.getItem('theme'));

    function getGMT3Now() { const n = new Date(); return new Date(n.getTime() + (n.getTimezoneOffset() * 60000) + (3 * 3600000)); }

    function update() {
        const now = getGMT3Now();
        document.getElementById('today-date').innerText = now.toLocaleDateString('ko-KR', { month: 'long', day: 'numeric', weekday: 'short' });
        document.getElementById('current-time').innerText = now.toLocaleTimeString('ko-KR', { hour12: false });

        // ì‹ë‹¨ ì—…ë°ì´íŠ¸
        const h = now.getHours();
        const dateStr = now.toISOString().split('T')[0];
        let targetDate = dateStr, mealType = "B", typeText = "ì¡°ì‹ (05:00)";
        if (h < 6) { mealType = "B"; typeText = "ì˜¤ëŠ˜ ì¡°ì‹"; }
        else if (h < 13) { mealType = "L"; typeText = "ì˜¤ëŠ˜ ì¤‘ì‹"; }
        else if (h < 20) { mealType = "D"; typeText = "ì˜¤ëŠ˜ ì„ì‹"; }
        else { const tmr = new Date(now); tmr.setDate(tmr.getDate()+1); targetDate = tmr.toISOString().split('T')[0]; mealType = "B"; typeText = "ë‚´ì¼ ì¡°ì‹"; }
        document.getElementById('next-meal-type').innerText = typeText;
        document.getElementById('next-meal-content').innerText = MEAL_DATA[targetDate] ? MEAL_DATA[targetDate][mealType] : "ì‹ë‹¨ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.";

        // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
        const progress = Math.max(0, Math.min(100, ((now - START_DATE) / (END_DATE - START_DATE)) * 100));
        document.getElementById('total-fill').style.width = progress + "%";
        document.getElementById('total-percent').innerText = progress.toFixed(8) + "%";

        // ê·¼ë¬´ ì‹œê°„ ì²´í¬ ë¡œì§ (ìƒëµ - ì´ì „ê³¼ ë™ì¼)
    }

    // --- ê²Œì‹œíŒ & ì¢‹ì•„ìš” ê¸°ëŠ¥ ---
    async function loadMemos() {
        if(!SCRIPT_URL.includes("http")) return;
        try {
            const res = await fetch(SCRIPT_URL + "?action=getMemos");
            const data = await res.json();
            const list = document.getElementById('memo-list');
            list.innerHTML = data.map((m, idx) => `
                <div class="comment-item">
                    <div style="padding-right: 60px;">${m.text}</div>
                    <div style="font-size: 0.7rem; color: var(--text-sub); margin-top:5px;">${m.date}</div>
                    <div class="like-btn" onclick="likeMemo(${m.id})">â¤ï¸ <span>${m.likes || 0}</span></div>
                </div>
            `).reverse().join('');
        } catch (e) {}
    }

    async function saveMemo() {
        const input = document.getElementById('memo-input');
        if(!input.value.trim()) return;
        const text = input.value; input.value = '';
        await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: "addMemo", text: text }) });
        loadMemos();
    }

    async function likeMemo(id) {
        await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: "likeMemo", id: id }) });
        loadMemos();
    }

    // --- ìº˜ë¦°ë” ìƒì„± (ê°„ë‹¨ ë²„ì „) ---
    function initCalendar() {
        const body = document.getElementById('calendar-body');
        const days = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
        let html = days.map(d => `<div style="font-size:0.7rem; font-weight:bold; text-align:center;">${d}</div>`).join('');
        for(let i=1; i<=31; i++) {
            html += `<div class="cal-day ${i===25?'has-event':''}" onclick="showEvent(${i})">${i}</div>`;
        }
        body.innerHTML = html;
    }

    function addEvent() {
        const msg = prompt("ë“±ë¡í•  ì¼ì •ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 1/26 14:00 ì£¼ê°„ íšŒì˜)");
        if(msg) alert("ì¼ì •ì´ ì„œë²„ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. (êµ¬ê¸€ ì‹œíŠ¸ ì—°ë™ í•„ìš”)");
    }

    setInterval(update, 100);
    setInterval(loadMemos, 1000); // 1ì´ˆë§ˆë‹¤ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
    initCalendar(); update(); loadMemos();
</script>

</body>
</html>
