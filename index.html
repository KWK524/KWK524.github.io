<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FGIP OJT Dashboard</title>
    <style>
        :root {
            --bg-color: #f8f9fa; --card-bg: #ffffff; --text-main: #111111;
            --text-sub: #666666; --accent-color: #007bff; --gauge-bg: #e9ecef;
            --highlight: #d9534f; --work-green: #28a745;
        }
        [data-theme="pink"] { --bg-color: #fff0f6; --card-bg: #ffffff; --text-main: #4b162c; --text-sub: #a67c8e; --accent-color: #ff85c0; --gauge-bg: #ffe0eb; }
        [data-theme="skyblue"] { --bg-color: #e6f7ff; --card-bg: #ffffff; --text-main: #002766; --text-sub: #69b1ff; --accent-color: #1890ff; --gauge-bg: #bae7ff; }
        [data-theme="white"] { --bg-color: #ffffff; --card-bg: #fdfdfd; --text-main: #000000; --text-sub: #888888; --accent-color: #444444; --gauge-bg: #eeeeee; --highlight: #333; }
        [data-theme="dark"] { --bg-color: #121212; --card-bg: #1e1e1e; --text-main: #e0e0e0; --text-sub: #a0a0a0; --accent-color: #bb86fc; --gauge-bg: #333333; --highlight: #cf6679; }

        body { font-family: 'Pretendard', sans-serif; background: var(--bg-color); color: var(--text-main); display: flex; justify-content: center; margin: 0; padding: 2rem 0; transition: 0.3s; }
        .container { background: var(--card-bg); padding: 2.5rem; border-radius: 24px; box-shadow: 0 15px 40px rgba(0,0,0,0.1); text-align: center; width: 95%; max-width: 500px; }
        
        .theme-selector { display: flex; justify-content: center; gap: 12px; margin-bottom: 2rem; }
        .theme-btn { width: 24px; height: 24px; border-radius: 50%; cursor: pointer; border: 2px solid rgba(0,0,0,0.1); }
        .btn-pink { background: #ff85c0; } .btn-skyblue { background: #1890ff; } .btn-white { background: #ffffff; } .btn-dark { background: #333333; }

        .header-title { color: var(--accent-color); font-size: 1.5rem; font-weight: 900; margin-bottom: 0.5rem; }
        .today-date { font-size: 2.2rem; font-weight: 800; }
        .current-time { font-size: 1.3rem; color: var(--text-sub); margin-bottom: 1.5rem; font-family: monospace; }

        .gauge-container { background: var(--gauge-bg); border-radius: 50px; height: 18px; overflow: hidden; margin-bottom: 0.5rem; }
        .gauge-fill { height: 100%; background: var(--accent-color); transition: width 0.05s linear; }
        .percent-text { font-size: 1.1rem; font-weight: 700; font-family: monospace; color: var(--accent-color); margin-bottom: 1.5rem; }

        #daily-section { display: none; margin: 1.5rem 0; padding: 1.2rem; border-radius: 16px; background: rgba(0,0,0,0.03); border: 1px dashed var(--accent-color); }
        .daily-text { color: var(--work-green); font-size: 0.9rem; font-weight: bold; margin-top: 8px; }

        .stats-grid { display: grid; gap: 1rem; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--gauge-bg); }
        .stat-card { text-align: left; padding: 1rem; background: rgba(0,0,0,0.02); border-radius: 12px; }
        .stat-label { font-size: 0.85rem; color: var(--text-sub); display: block; }
        .stat-value { font-size: 1.15rem; font-weight: 700; }

        /* Í≥µÏú† Î©îÎ™®Ïû• ÎîîÏûêÏù∏ */
        .comment-section { margin-top: 2rem; padding-top: 1.5rem; border-top: 2px solid var(--gauge-bg); text-align: left; }
        .comment-input-wrapper { background: rgba(0,0,0,0.03); border-radius: 12px; padding: 10px; margin-bottom: 1rem; }
        textarea { width: 100%; background: transparent; border: none; color: var(--text-main); font-family: inherit; resize: none; outline: none; min-height: 60px; }
        .save-btn { background: var(--accent-color); color: white; border: none; padding: 8px 16px; border-radius: 8px; font-weight: bold; cursor: pointer; float: right; }
        .comment-list { list-style: none; padding: 0; margin-top: 4rem; }
        .comment-item { padding: 12px 0; border-bottom: 1px solid var(--gauge-bg); font-size: 0.95rem; }
        .comment-date { font-size: 0.75rem; color: var(--text-sub); margin-top: 5px; }
    </style>
</head>
<body data-theme="skyblue">

<div class="container">
    <div class="theme-selector">
        <div class="theme-btn btn-pink" onclick="setTheme('pink')"></div>
        <div class="theme-btn btn-skyblue" onclick="setTheme('skyblue')"></div>
        <div class="theme-btn btn-white" onclick="setTheme('white')"></div>
        <div class="theme-btn btn-dark" onclick="setTheme('dark')"></div>
    </div>

    <div class="header-title">FGIP OJT</div>
    <div id="today-date" class="today-date"></div>
    <div id="current-time" class="current-time"></div>
    
    <div class="gauge-container"><div id="total-fill" class="gauge-fill"></div></div>
    <div id="total-percent" class="percent-text">0.00000000%</div>

    <div id="daily-section">
        <div class="gauge-container"><div id="daily-fill" class="gauge-fill" style="background:var(--work-green)"></div></div>
        <div id="daily-remain-text" class="daily-text"></div>
    </div>

    <div class="stats-grid">
        <div class="stat-card"><span class="stat-label">üìÖ ÎÇ®ÏùÄ Í∑ºÎ¨¥Ïùº</span><span id="remain-days" class="stat-value">0Ïùº</span></div>
        <div class="stat-card"><span class="stat-label">‚è∞ Ï¥ù ÎÇ®ÏùÄ ÏàúÏàò ÏóÖÎ¨¥ ÏãúÍ∞Ñ</span><span id="remain-work-hours" class="stat-value" style="color:var(--highlight)">0ÏãúÍ∞Ñ 0Î∂Ñ 0Ï¥à</span></div>
    </div>

    <div class="comment-section">
        <div style="font-weight: 800; margin-bottom: 1rem;">üí¨ Ïã§ÏãúÍ∞Ñ Í≥µÏú† Í≤åÏãúÌåê</div>
        <div class="comment-input-wrapper">
            <textarea id="memo-input" placeholder="Ïó¨Í∏∞Ïóê Í∏ÄÏùÑ ÎÇ®Í∏∞Î©¥ Î™®ÎëêÏóêÍ≤å Í≥µÏú†Îê©ÎãàÎã§..."></textarea>
            <button class="save-btn" onclick="saveMemo()">Îì±Î°ù</button>
            <div style="clear:both;"></div>
        </div>
        <div id="loading" style="display:none; font-size: 0.8rem; color: var(--text-sub);">Î∂àÎü¨Ïò§Îäî Ï§ë...</div>
        <ul id="memo-list" class="comment-list"></ul>
    </div>
</div>

<script>
    // ‚ö†Ô∏è 2Î≤à Îã®Í≥ÑÏóêÏÑú Î∞úÍ∏âÎ∞õÏùÑ Ï£ºÏÜåÎ•º Ïó¨Í∏∞Ïóê ÎÑ£ÏúºÏÑ∏Ïöî!
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwkynypFv3mDGgn9w0oWCzRzfbp0TxEib3pR6bxhDiB8-DqhM_gUpZ9JK0T7BfXBFKRkQ/exec"; 

    const START_DATE = new Date('2025-08-31T00:00:00+03:00');
    const END_DATE = new Date('2026-02-14T15:00:00+03:00');

    function setTheme(t) { document.body.setAttribute('data-theme', t); localStorage.setItem('theme', t); }
    if(localStorage.getItem('theme')) setTheme(localStorage.getItem('theme'));

    function getGMT3Now() { const n = new Date(); return new Date(n.getTime() + (n.getTimezoneOffset() * 60000) + (3 * 3600000)); }

    function update() {
        const now = getGMT3Now();
        document.getElementById('today-date').innerText = now.toLocaleDateString('ko-KR', { month: 'long', day: 'numeric', weekday: 'short' });
        document.getElementById('current-time').innerText = now.toLocaleTimeString('ko-KR', { hour12: false });

        const progress = Math.max(0, Math.min(100, ((now - START_DATE) / (END_DATE - START_DATE)) * 100));
        document.getElementById('total-fill').style.width = progress + "%";
        document.getElementById('total-percent').innerText = progress.toFixed(8) + "%";

        let remainDays = 0, totalWorkSec = 0, isWorkingNow = false, dailyRem = 0, dailyProg = 0;
        let scan = new Date(now); scan.setHours(0,0,0,0);
        let tomorrow = new Date(scan); tomorrow.setDate(tomorrow.getDate() + 1);

        while (scan <= END_DATE) {
            const day = scan.getDay(), isLast = scan.toDateString() === END_DATE.toDateString(), isShort = (day === 4 || isLast);
            if (day !== 5) {
                if (scan >= tomorrow) remainDays++;
                const shifts = [{s:6, e:12}, {s:13, e:isShort?15:17}];
                shifts.forEach(sh => {
                    let sT = new Date(scan).setHours(sh.s,0,0,0), eT = new Date(scan).setHours(sh.e,0,0,0);
                    let effS = Math.max(sT, now.getTime());
                    if (effS < eT) totalWorkSec += (eT - effS) / 1000;
                });
                if (scan.toDateString() === now.toDateString()) {
                    let dS = new Date(scan).setHours(6,0,0,0), dE = new Date(scan).setHours(isShort?15:17,0,0,0);
                    if (now >= dS && now < dE) { isWorkingNow = true; dailyProg = ((now - dS)/(dE - dS))*100; dailyRem = (dE - now)/1000; }
                }
            }
            scan.setDate(scan.getDate() + 1);
        }
        document.getElementById('remain-days').innerText = remainDays + "Ïùº";
        document.getElementById('remain-work-hours').innerText = `${Math.floor(totalWorkSec/3600).toLocaleString()}ÏãúÍ∞Ñ ${Math.floor((totalWorkSec%3600)/60)}Î∂Ñ ${Math.floor(totalWorkSec%60)}Ï¥à`;

        const dSec = document.getElementById('daily-section');
        if (isWorkingNow) {
            dSec.style.display = 'block'; document.getElementById('daily-fill').style.width = dailyProg + "%";
            document.getElementById('daily-remain-text').innerText = `Ìá¥Í∑ºÍπåÏßÄ ${String(Math.floor(dailyRem/3600)).padStart(2,'0')}:${String(Math.floor((dailyRem%3600)/60)).padStart(2,'0')}:${String(Math.floor(dailyRem%60)).padStart(2,'0')} ÎÇ®Ïùå`;
        } else dSec.style.display = 'none';
    }

    // --- Ïã§ÏãúÍ∞Ñ Í≥µÏú† Î©îÎ™®Ïû• Í∏∞Îä• ---
    async function loadMemos() {
        if(!SCRIPT_URL.includes("http")) return;
        document.getElementById('loading').style.display = 'block';
        try {
            const res = await fetch(SCRIPT_URL);
            const data = await res.json();
            const list = document.getElementById('memo-list');
            list.innerHTML = data.map(m => `
                <li class="comment-item">
                    <div>${m.text}</div>
                    <div class="comment-date">${m.date}</div>
                </li>
            `).reverse().join('');
        } catch (e) { console.error("Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®"); }
        document.getElementById('loading').style.display = 'none';
    }

    async function saveMemo() {
        const input = document.getElementById('memo-input');
        const text = input.value.trim();
        if(!text || !SCRIPT_URL.includes("http")) return;
        
        input.disabled = true;
        try {
            await fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify({ text: text })
            });
            input.value = '';
            await loadMemos();
        } catch (e) { alert("Ï†ÑÏÜ° Ïã§Ìå®"); }
        input.disabled = false;
    }

    setInterval(update, 50);
    setInterval(loadMemos, 10000); // 10Ï¥àÎßàÎã§ ÏÉà ÎåìÍ∏Ä ÌôïÏù∏
    update(); loadMemos();
</script>

</body>
</html>
